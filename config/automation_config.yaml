# Dreamweaving Automation Configuration
#
# This file controls the automated video generation and upload pipeline.
# All times are in MST (Mountain Standard Time).

generation:
  # Number of sessions to generate each day (12am MST)
  target_sessions_per_night: 3

  # Cost optimization mode: budget | standard | premium
  # - budget:   Minimal AI usage, ~$0.70 per session
  # - standard: Balanced quality/cost, ~$1.06 per session (recommended)
  # - premium:  Maximum quality, ~$1.51 per session
  mode: standard

  # Image generation method: sd | midjourney | stock | pil | random
  # - sd:        Local Stable Diffusion (slow but fully automated, best quality)
  # - pil:       Fast procedural PIL generation (uses generate_video_images.py)
  # - random:    Use random images from project images/ folder (fast, fully automated)
  # - midjourney: Generate prompts only (requires manual image creation)
  # - stock:     Search guides for Unsplash/Pexels (requires manual download)
  image_method: random

upload:
  # Video selection strategy: quality | fifo | priority
  # - quality:  Upload highest quality-scored video first
  # - fifo:     Upload oldest generated video first
  # - priority: Manual priority override, then quality
  selection_strategy: quality

  # Whether to pull optimal upload times from YouTube analytics
  use_analytics_timing: true

  # Fallback upload times if analytics unavailable (MST)
  fallback_long_upload_time: "12:00"
  fallback_shorts_upload_time: "08:00"

  # YouTube video category
  # 22 = People & Blogs (good for meditation/hypnosis content)
  category_id: "22"

shorts:
  # Target duration for shorts (30-60 seconds allowed)
  duration_seconds: 40

  # Duration of CTA overlay at end
  cta_duration_seconds: 8

  # Source content for shorts
  # website_only: Only create shorts from content on website but NOT on YouTube
  source: website_only

youtube:
  # Target YouTube channel
  channel_name: "Randy Salars"
  channel_url: "https://www.youtube.com/@RandySalars"

  # OAuth credentials directory (relative to project root)
  # Must contain: client_secret.json
  # Will create: token.json (after first OAuth flow)
  credentials_dir: config/youtube_credentials

notion:
  # Notion database with topic ideas
  topic_database_id: "2c22bab3-796d-81fb-bdf8-efd2aab0159e"

  # Notion root page for topic hierarchy
  root_page_id: "1ee2bab3796d80738af6c96bd5077acf"

database:
  # SQLite database for state tracking
  path: data/automation_state.db

archive:
  # Whether to archive uploaded sessions
  enabled: true

  # Archive directory (relative to project root)
  archive_dir: archive

  # Archive immediately after YouTube upload
  archive_after_youtube_upload: true

logging:
  # Log directory for automation logs
  log_dir: data/logs/automation

  # Log level: DEBUG | INFO | WARNING | ERROR
  log_level: INFO

# CRON SCHEDULING
# ===============
# Automation enabled as of 2025-12-09
# Fixed 2025-12-15: Changed to local time (CRON_TZ was being ignored)
cron:
  enabled: true

  # Daily generation: 12am MST (midnight local time)
  nightly_generation: "0 0 * * *"

  # YouTube uploads disabled
  daily_upload: null

  # Shorts uploads disabled
  daily_shorts: null

  # Automated learning jobs (collects analytics and updates knowledge base)
  # Daily: Fetch analytics for videos uploaded 48+ hours ago
  # Runs at 3pm MST = 10pm UTC (after most daily views are recorded)
  daily_analytics: null

  # Weekly: Deep analysis and lesson extraction
  # Runs Sunday at 3am MST = 10am UTC
  weekly_learning: "0 10 * * 0"

# LEARNING SYSTEM
# ===============
# Automated feedback collection and knowledge base updates
learning:
  # Minimum video age (hours) before fetching analytics
  min_video_age_hours: 48

  # Performance thresholds for categorizing videos
  thresholds:
    excellent:
      views_per_day: 100
      retention_percent: 60
    good:
      views_per_day: 50
      retention_percent: 45
    average:
      views_per_day: 20
      retention_percent: 30

  # Auto-update lessons_learned.yaml with findings
  auto_update_lessons: true

  # Categories to track
  tracked_patterns:
    - theme_performance    # Which themes get more views
    - duration_impact      # How duration affects retention
    - title_patterns       # What titles drive clicks
    - thumbnail_effect     # Future: A/B test thumbnails

# RECURSIVE IMPROVEMENT SYSTEM
# ============================
# Self-evolving agent that continuously improves session generation
# by tracking lesson effectiveness and correlating with outcomes.
recursive_improvement:
  # Enable/disable recursive improvement system
  enabled: true

  # Minimum number of times a lesson must be applied before effectiveness scoring kicks in
  # Prevents over-fitting to small samples
  min_applications: 3

  # Effectiveness score thresholds for lesson confidence management
  # Lessons are ranked 0-100, where 50 is neutral
  promotion_threshold: 70.0    # Score >= 70: Promote to high confidence
  demotion_threshold: 40.0     # Score < 40: Demote to low confidence
  archive_threshold: 30.0      # Score < 30: Archive (rarely applied)

  # Time decay half-life in days
  # Lessons lose relevance over time; recent lessons are weighted higher
  decay_half_life_days: 60

  # Days to wait after session publication before checking YouTube analytics
  # Allows time for views, engagement, and retention data to accumulate
  youtube_check_delay_days: 7

  # Effectiveness scoring weights (must sum to 1.0)
  weights:
    success_rate: 0.25       # Did generation succeed?
    quality_impact: 0.20     # Quality score delta vs baseline
    retention_impact: 0.25   # YouTube retention delta
    engagement_impact: 0.15  # YouTube engagement delta
    recency: 0.10            # Recent lessons preferred
    consistency: 0.05        # Lower variance = higher score

  # Baseline metrics for comparison (auto-updated weekly)
  baseline_metrics:
    avg_quality_score: 65.0
    avg_retention_pct: 35.0
    avg_engagement_rate: 0.03

  # Automation schedule (in cron format, MST timezone)
  cron:
    # Process pending YouTube outcome checks
    # Runs 3 AM daily
    process_pending_outcomes: "0 3 * * *"

    # Recalculate all lesson rankings
    # Runs 4 AM Sunday
    recalculate_rankings: "0 4 * * 0"

    # Sync YouTube analytics for tracked videos
    # Runs 5 AM daily
    sync_youtube_analytics: "0 5 * * *"

    # Knowledge optimization and gap detection
    # Runs 6 AM Monday
    optimize_knowledge: "0 6 * * 1"

  # Agent types with recursive improvement
  agents:
    dreamweaver:
      enabled: true
      categories:
        - content
        - audio
        - feedback
    rag:
      enabled: true
      # Query effectiveness tracking
      query_tracking:
        max_cache_size: 500
        cache_score_threshold: 70.0
        min_uses_for_ranking: 2
      # Relationship traversal defaults
      traversal:
        default_depth: 2
        include_realms: true
        include_frequencies: true
        max_tokens: 2000
    website:
      enabled: true
      # Google Analytics configuration
      analytics:
        measurement_id: "G-F8GVPD8N2H"
        stream_id: "13137691426"
        min_views_for_tracking: 10
      # Content tracking settings
      tracking:
        snapshot_frequency: "weekly"
        history_retention_months: 12
        engagement_thresholds:
          high: 70.0
          low: 40.0
      # Improvement settings
      improvements:
        auto_suggest: true
        max_suggestions_per_page: 5
        pattern_extraction_min_performers: 5
      # SEO optimization
      seo:
        auto_analyze: true
        target_score: 70.0
        keyword_clusters:
          - hypnosis
          - meditation
          - binaural
          - spiritual
          - healing
